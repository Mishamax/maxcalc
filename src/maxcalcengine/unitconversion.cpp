
// Local
#include "unitconversion.h"
#include "exceptions.h"

namespace MaxCalcEngine {

// All constants have 150 digits precision
SimpleConversion UnitConversion::simpleConversions_[] =
{
	//---------------------------------------------------------------------
	// Length
	// Mil
	_T("mil"),		_T("in"),		"0.001",
	_T("mil"),		_T("ft"),		"0.0000833333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333",
	_T("mil"),		_T("yd"),		"0.0000277777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777778",
	_T("mil"),		_T("mi"),		"1.5782828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828283e-8",
	_T("mil"),		_T("micron"),	"25.4",
	_T("mil"),		_T("mm"),		"0.0254",
	_T("mil"),		_T("cm"),		"0.00254",
	_T("mil"),		_T("m"),		"0.0000254",
	_T("mil"),		_T("km"),		"0.0000000254",
	// Inch
	_T("in"),		_T("mil"),		"1000",
	_T("in"),		_T("ft"),		"0.0833333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333",
	_T("in"),		_T("yd"),		"0.0277777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777778",
	_T("in"),		_T("mi"),		"1.5782828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828282828283e-5",
	_T("in"),		_T("micron"),	"25400",
	_T("in"),		_T("mm"),		"25.4",
	_T("in"),		_T("cm"),		"2.54",
	_T("in"),		_T("m"),		"0.0254",
	_T("in"),		_T("km"),		"0.0000254",
	// Foot
	_T("ft"),		_T("mil"),		"12000",
	_T("ft"),		_T("in"),		"12",
	_T("ft"),		_T("yd"),		"0.3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333",
	_T("ft"),		_T("mi"),		"1.8939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939393939e-4",
	_T("ft"),		_T("micron"),	"304800",
	_T("ft"),		_T("mm"),		"304.8",
	_T("ft"),		_T("cm"),		"30.48",
	_T("ft"),		_T("m"),		"0.3048",
	_T("ft"),		_T("km"),		"0.0003048",
	// Yard
	_T("yd"),		_T("mil"),		"36000",
	_T("yd"),		_T("in"),		"36",
	_T("yd"),		_T("ft"),		"3",
	_T("yd"),		_T("mi"),		"5.6818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818e-4",
	_T("yd"),		_T("micron"),	"914400",
	_T("yd"),		_T("mm"),		"914.4",
	_T("yd"),		_T("cm"),		"91.44",
	_T("yd"),		_T("m"),		"0.9144",
	_T("yd"),		_T("km"),		"0.0009144",
	// Mile
	_T("mi"),		_T("mil"),		"63360000",
	_T("mi"),		_T("in"),		"63360",
	_T("mi"),		_T("ft"),		"5280",
	_T("mi"),		_T("yd"),		"1760",
	_T("mi"),		_T("micron"),	"1609344000",
	_T("mi"),		_T("mm"),		"1609344",
	_T("mi"),		_T("cm"),		"160934.4",
	_T("mi"),		_T("m"),		"1609.344",
	_T("mi"),		_T("km"),		"1.609344",
	// Micrometer
	_T("micron"),	_T("mil"),		"0.03937007874015748031",
	_T("micron"),	_T("in"),		"0.00003937007874015748031",
	_T("micron"),	_T("ft"),		"0.00000328083989501312336",
	_T("micron"),	_T("yd"),		"0.00000109361329833770779",
	_T("micron"),	_T("mi"),		"6.21371192237333969617e-10",
	_T("micron"),	_T("mm"),		"0.001",
	_T("micron"),	_T("cm"),		"0.0001",
	_T("micron"),	_T("m"),		"0.000001",
	_T("micron"),	_T("km"),		"0.000000001",
	// Millimeter
	_T("mm"),		_T("mil"),		"39370.078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921e-3",
	_T("mm"),		_T("in"),		"39.370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921e-3",
	_T("mm"),		_T("ft"),		"3.2808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934e-3",
	_T("mm"),		_T("yd"),		"1.0936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841645e-3",
	_T("mm"),		_T("mi"),		"6.2137119223733396961743418436331822158593812137119223733396961743418436331822158593812137119223733396961743418436331822158593812137119223733396961743418436e-7",
	_T("mm"),		_T("micron"),	"1000",
	_T("mm"),		_T("cm"),		"0.1",
	_T("mm"),		_T("m"),		"0.001",
	_T("mm"),		_T("km"),		"0.000001",
	// Cantimeter
	_T("cm"),		_T("mil"),		"39370.078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921e-2",
	_T("cm"),		_T("in"),		"39.370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921e-2",
	_T("cm"),		_T("ft"),		"3.2808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934e-2",
	_T("cm"),		_T("yd"),		"1.0936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841645e-2",
	_T("cm"),		_T("mi"),		"6.2137119223733396961743418436331822158593812137119223733396961743418436331822158593812137119223733396961743418436331822158593812137119223733396961743418436e-6",
	_T("cm"),		_T("micron"),	"10000",
	_T("cm"),		_T("mm"),		"10",
	_T("cm"),		_T("m"),		"0.01",
	_T("cm"),		_T("km"),		"0.00001",
	// Meter
	_T("m"),		_T("mil"),		"39370.078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921",
	_T("m"),		_T("in"),		"39.370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921",
	_T("m"),		_T("ft"),		"3.2808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934",
	_T("m"),		_T("yd"),		"1.0936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841645",
	_T("m"),		_T("mi"),		"6.2137119223733396961743418436331822158593812137119223733396961743418436331822158593812137119223733396961743418436331822158593812137119223733396961743418436e-4",
	_T("m"),		_T("micron"),	"1000000",
	_T("m"),		_T("mm"),		"1000",
	_T("m"),		_T("cm"),		"100",
	_T("m"),		_T("km"),		"0.001",
	// Kilometer
	_T("km"),		_T("mil"),		"39370.078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921e+3",
	_T("km"),		_T("in"),		"39.370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921e+3",
	_T("km"),		_T("ft"),		"3.2808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934383202099737532808398950131233595800524934e+3",
	_T("km"),		_T("yd"),		"1.0936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841645e+3",
	_T("km"),		_T("mi"),		"0.6213711922373339696174341843633182215859381213711922373339696174341843633182215859381213711922373339696174341843633182215859381213711922373339696174341844",
	_T("km"),		_T("micron"),	"1000000000",
	_T("km"),		_T("mm"),		"1000000",
	_T("km"),		_T("cm"),		"100000",
	_T("km"),		_T("m"),		"1000",
	//---------------------------------------------------------------------
	// Weight
	// Pound
	_T("lb"),		_T("oz"),		"16.000002821917267029565227206668754885444268544934799601545281895425389918418371810175269281455206296261806196365934943519325900403251977458524870967832965",
	_T("lb"),		_T("g"),		"453.5924",
	_T("lb"),		_T("kg"),		"0.4535924",
	// Ounce
	_T("oz"),		_T("lb"),		"0.0624999889768876198102084602828442451857658990759104429439293956424313987624131268513317242528754890954963090210506172502008411075670580018536465778527153",
	_T("oz"),		_T("g"),		"28.34952",
	_T("oz"),		_T("kg"),		"0.02834952",
	// Gramme
	_T("g"),		_T("lb"),		"0.0022046224760379583079434311509628468201848179114112141208715137202475173746297336551494249021809007381957898765499598317784865883996292706844294569309362",
	_T("g"),		_T("oz"),		"0.0352739658378695653400833594360680533568116849950193160236928173739802296476271908660181900787032725774545741867939915737550406497182315608870979120634141",
	_T("g"),		_T("kg"),		"0.001",
	// Kilogramme
	_T("kg"),		_T("lb"),		"2.2046224760379583079434311509628468201848179114112141208715137202475173746297336551494249021809007381957898765499598317784865883996292706844294569309362326",
	_T("kg"),		_T("oz"),		"35.273965837869565340083359436068053356811684995019316023692817373980229647627190866018190078703272577454574186793991573755040649718231560887097912063414125",
	_T("kg"),		_T("g"),		"1000",
	//---------------------------------------------------------------------
	// Time
	// Microsecond
	_T("micros"),	_T("ms"),		"0.001",
	_T("micros"),	_T("s"),		"0.000001",
	_T("micros"),	_T("min"),		"0.0000000166666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666667",
	_T("micros"),	_T("h"),		"2.7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777778e-10",
	_T("micros"),	_T("d"),		"1.1574074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074e-11",
	// Millisecond
	_T("ms"),		_T("micros"),	"1000",
	_T("ms"),		_T("s"),		"0.001",
	_T("ms"),		_T("min"),		"0.0000166666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666667",
	_T("ms"),		_T("h"),		"2.7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777778e-7",
	_T("ms"),		_T("d"),		"1.1574074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074e-8",
	// Second
	_T("s"),		_T("micros"),	"1000000",
	_T("s"),		_T("ms"),		"1000",
	_T("s"),		_T("min"),		"0.0166666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666667",
	_T("s"),		_T("h"),		"2.7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777778e-4",
	_T("s"),		_T("d"),		"1.1574074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074074e-5",
	// Minute
	_T("min"),		_T("miros"),	"60000000",
	_T("min"),		_T("ms"),		"60000",
	_T("min"),		_T("s"),		"60",
	_T("min"),		_T("h"),		"0.0166666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666667",
	_T("min"),		_T("d"),		"6.9444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444e-4",
	// Hour
	_T("h"),		_T("micros"),	"3600000000",
	_T("h"),		_T("ms"),		"3600000",
	_T("h"),		_T("s"),		"3600",
	_T("h"),		_T("min"),		"60",
	_T("h"),		_T("d"),		"0.0416666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666667",
	// Day
	_T("d"),		_T("micros"),	"86400000000",
	_T("d"),		_T("ms"),		"86400000",
	_T("d"),		_T("sec"),		"86400",
	_T("d"),		_T("min"),		"1440",
	_T("d"),		_T("h"),		"24",
	//---------------------------------------------------------------------
	// Speed
	// mi/hour
	_T("mi/h"),	_T("m/s"),			"0.44704",
	_T("mi/h"),	_T("ft/h"),			"1760",
	_T("mi/h"),	_T("km/h"),			"1.609344",
	_T("mi/h"),	_T("knot"),			"0.8689762419006479481641468682505399568034557235421166306695464362850971922246220302375809935205183585313174946004319654427645788336933045356371490280777538",
	// Meter/second
	_T("m/s"),		_T("mi/h"),		"2.2369362920544022906227630637079455977093772369362920544022906227630637079455977093772369362920544022906227630637079455977093772369362920544022906227630637",
	_T("m/s"),		_T("ft/h"),		"3937.0078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921259842519685039370078740157480314960629921",
	_T("m/s"),		_T("km/h"),		"3.6",
	_T("m/s"),		_T("knot"),		"1.9438444924406047516198704103671706263498920086393088552915766738660907127429805615550755939524838012958963282937365010799136069114470842332613390928725702",
	// Foot/hour
	_T("ft/h"),		_T("mi/h"),		"5.6818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818181818e-4",
	_T("ft/h"),		_T("m/s"),		"0.000254",
	_T("ft/h"),		_T("km/h"),		"0.0009144",
	_T("ft/h"),		_T("knot"),		"4.9373650107991360691144708423326133909287257019438444924406047516198704103671706263498920086393088552915766738660907127429805615550755939524838012958963283e-4",
	// Kilometre/hour
	_T("km/h"),		_T("mi/h"),		"0.6213711922373339696174341843633182215859381213711922373339696174341843633182215859381213711922373339696174341843633182215859381213711922373339696174341844",
	_T("km/h"),		_T("m/s"),		"0.2777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777778",
	_T("km/h"),		_T("ft/h"),		"1093.6132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841644794400699912510936132983377077865266841645",
	_T("km/h"),		_T("knot"),		"0.5399568034557235421166306695464362850971922246220302375809935205183585313174946004319654427645788336933045356371490280777537796976241900647948164146868251",
	// Knot
	_T("knot"),		_T("mi/h"),		"1.1507794480235425117314881094408653463771574007794480235425117314881094408653463771574007794480235425117314881094408653463771574007794480235425117314881094",
	_T("knot"),		_T("m/s"),		"0.5144444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444",
	_T("knot"),		_T("ft/h"),		"2025.3718285214348206474190726159230096237970253718285214348206474190726159230096237970253718285214348206474190726159230096237970253718285214348206474190726",
	_T("knot"),		_T("km/h"),		"1.852",
	{ _T(""), _T(""), 0 }
};

ArbitraryConversion UnitConversion::arbitraryConversions_[] =
{
	{ _T("c"), _T("f"), UnitConversion::ctof },
	{ _T("c"), _T("k"), UnitConversion::ctok },
	{ _T("f"), _T("c"), UnitConversion::ftoc },
	{ _T("f"), _T("k"), UnitConversion::ftok },
	{ _T("k"), _T("c"), UnitConversion::ktoc },
	{ _T("k"), _T("f"), UnitConversion::ktof },
	{ _T(""), _T(""), 0 }
};

BigDecimal UnitConversion::convert(const BigDecimal arg, const tstring & unit1, const tstring & unit2)
{
	// Look up simple conversions table
	for (SimpleConversion * cur = simpleConversions_; cur->unit1.length() != 0; cur++)
	{
		if (unit1 == cur->unit1 && unit2 == cur->unit2)
			return arg * cur->multiplier;
	}

	// Look up arbitrary conversions table
	for (ArbitraryConversion * cur = arbitraryConversions_; cur->unit1.length() != 0; cur++)
	{
		if (unit1 == cur->unit1 && unit2 == cur->unit2)
			return cur->convert(arg);
	}

	throw UnknownUnitConversionException();
}

} // namespace MaxCalcEngine
